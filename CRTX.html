<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ç«èµ›æŠ½äººç³»ç»Ÿ - 12ä¸ªç»„æŠ½äºº</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0c2461 0%, #1e3799 50%, #4a69bd 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 20px 0 30px;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            background: linear-gradient(to right, #ffd700, #ff9800);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: inline-block;
            padding: 5px 20px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-top: 10px;
        }
        
        .content-wrapper {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
        }
        
        .control-panel {
            flex: 1;
            min-width: 320px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .result-display {
            flex: 2;
            min-width: 320px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .panel-title {
            font-size: 1.6rem;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            color: #ffd700;
        }
        
        .group-selector {
            margin-bottom: 25px;
        }
        
        .group-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }
        
        .group-btn {
            padding: 14px 5px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .group-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .group-btn.active {
            background: linear-gradient(135deg, #ff9800, #ff5722);
            box-shadow: 0 5px 15px rgba(255, 87, 34, 0.4);
            border-color: #ff9800;
        }
        
        .control-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 25px;
        }
        
        .btn {
            padding: 18px 10px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .draw-btn {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
        }
        
        .draw-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(76, 175, 80, 0.4);
        }
        
        .reset-btn {
            background: linear-gradient(135deg, #9C27B0, #6A1B9A);
            color: white;
        }
        
        .reset-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(156, 39, 176, 0.4);
        }
        
        .draw-all-btn {
            background: linear-gradient(135deg, #2196F3, #0D47A1);
            color: white;
        }
        
        .draw-all-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(33, 150, 243, 0.4);
        }
        
        .reset-all-btn {
            background: linear-gradient(135deg, #f44336, #b71c1c);
            color: white;
        }
        
        .reset-all-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(244, 67, 54, 0.4);
        }
        
        .members-list {
            margin-top: 25px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
        }
        
        .members-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        .members-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .member-tag {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.95rem;
        }
        
        .result-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .result-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .result-card.drawn {
            background: rgba(255, 215, 0, 0.15);
            border: 2px solid #ffd700;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3);
        }
        
        .result-card h3 {
            font-size: 1.4rem;
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        .result-name {
            font-size: 2.2rem;
            font-weight: bold;
            margin: 15px 0;
            min-height: 3rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .result-status {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .drawing-animation {
            animation: drawing 0.8s infinite alternate;
        }
        
        @keyframes drawing {
            from { transform: scale(1); box-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
            to { transform: scale(1.05); box-shadow: 0 0 20px rgba(255, 215, 0, 0.8); }
        }
        
        .winner-effect {
            animation: winner 1.5s ease;
        }
        
        @keyframes winner {
            0% { transform: scale(1); }
            25% { transform: scale(1.1); box-shadow: 0 0 30px rgba(255, 215, 0, 0.8); }
            50% { transform: scale(1.05); }
            75% { transform: scale(1.1); box-shadow: 0 0 40px rgba(255, 215, 0, 0.9); }
            100% { transform: scale(1); }
        }
        
        .history-panel {
            margin-top: 30px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
        }
        
        .history-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #ffd700;
        }
        
        .history-list {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .history-item {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 0.95rem;
            display: flex;
            justify-content: space-between;
        }
        
        .history-item:nth-child(odd) {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .history-winner {
            font-weight: bold;
            color: #ffd700;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .instructions {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        @media (max-width: 768px) {
            .content-wrapper {
                flex-direction: column;
            }
            
            .group-buttons {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .result-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            h1 {
                font-size: 2.2rem;
            }
        }
        
        @media (max-width: 480px) {
            .result-container {
                grid-template-columns: 1fr;
            }
            
            .group-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ‰ å°ç«èµ›æŠ½äººç³»ç»Ÿ ğŸ‰</h1>
            <p class="subtitle">12ä¸ªç»„ï¼Œæ¯ä¸ªç»„æŠ½å–1åå¹¸è¿å„¿</p>
        </header>
        
        <div class="content-wrapper">
            <div class="control-panel">
                <h2 class="panel-title">æŠ½äººæ§åˆ¶</h2>
                
                <div class="group-selector">
                    <p style="margin-bottom: 15px; font-size: 1.1rem;">è¯·é€‰æ‹©è¦æŠ½äººçš„ç»„ï¼š</p>
                    <div class="group-buttons" id="groupButtons">
                        <!-- å°ç»„æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
                
                <div class="members-list">
                    <div class="members-title" id="membersTitle">ç¬¬1ç»„æˆå‘˜ï¼š</div>
                    <div class="members-container" id="membersContainer">
                        <!-- å°ç»„æˆå‘˜å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
                
                <div class="control-buttons">
                    <button class="btn draw-btn" id="drawBtn">
                        <span>ğŸ¯</span> å¼€å§‹æŠ½äºº
                    </button>
                    <button class="btn reset-btn" id="resetBtn">
                        <span>ğŸ”„</span> é‡ç½®æœ¬ç»„
                    </button>
                    <button class="btn draw-all-btn" id="drawAllBtn">
                        <span>ğŸš€</span> ä¸€é”®æŠ½å–å…¨éƒ¨
                    </button>
                    <button class="btn reset-all-btn" id="resetAllBtn">
                        <span>ğŸ—‘ï¸</span> é‡ç½®å…¨éƒ¨
                    </button>
                </div>
                
                <div class="instructions">
                    <p><strong>ä½¿ç”¨è¯´æ˜ï¼š</strong></p>
                    <p>1. ç‚¹å‡»ä¸Šæ–¹æ•°å­—æŒ‰é’®é€‰æ‹©å°ç»„</p>
                    <p>2. ç‚¹å‡»"å¼€å§‹æŠ½äºº"æŠ½å–å½“å‰å°ç»„</p>
                    <p>3. æ”¯æŒé”®ç›˜å¿«æ·é”®ï¼šæ•°å­—é”®1-12é€‰æ‹©å°ç»„ï¼Œç©ºæ ¼/å›è½¦é”®æŠ½å¥–</p>
                </div>
            </div>
            
            <div class="result-display">
                <h2 class="panel-title">æŠ½äººç»“æœå±•ç¤º</h2>
                <div class="result-container" id="resultContainer">
                    <!-- 12ä¸ªç»„çš„ç»“æœå¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="history-panel">
                    <div class="history-title">æŠ½äººå†å²è®°å½•</div>
                    <div class="history-list" id="historyList">
                        <!-- æŠ½äººå†å²è®°å½•å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>å°ç«èµ›æŠ½äººç³»ç»Ÿ | å…±12ä¸ªç»„ï¼Œæ¯ä¸ªç»„æŠ½å–1äºº </p>
            <p style="margin-top: 5px;">Â© 2026 å°ç«èµ›æŠ½äººç³»ç»Ÿ</p>
        </footer>
    </div>
    
    <script>
        // æ ¹æ®æä¾›çš„åå•åˆå§‹åŒ–å°ç»„æ•°æ®
        const groups = [
            {
                id: 1,
                name: "1",
                members: [ "å´ç‘¶", "å®‹æµ©æ±Ÿ","æçƒ","æ±ªæ•¦æ ¹","å®‹çº¢ä¼Ÿ","é™ˆç","èµµå­æ‰¬","å¼ æ©è¾‰","ç§¦ç‘","æ…•æµ©å—"],
                drawnMember: null
            },
            {
                id: 2,
                name: "2",
                members: ["ææ´‹", "å´æœç‚œ","ç‹å®‡ä¸œ","ç™½å°‘æ°","é™ˆæ³³å»¶","è¢è‰¯æ—","å­™é‘«æ³½","å¼ æ–‡é¹","éŸ©æ´‹","éŸ©ä½³ä¼Ÿ"],
                drawnMember: null
            },
            {
                id: 3,
                name: "3",
                members: ["ç‹ä½©ä¼Ÿ", "é—«ç‚³æ—­","èˆ’äº®","å¼ å®‡ç¦","å¼ åšæ€","çª¦æ³½é¹","ç‹æµ©å¤©","æå—è¾‰","æå‰‘è¶…"],
                drawnMember: null
            },
            {
                id: 4,
                name: "4",
                members: ["åˆ˜å¹¿å¤š", "å‘¨æ´‹","é‚¢æˆæ¾","å¼ å‡¯","å¼ å˜‰é¹","ç†Šä¹ä¹","é»„é¸¿","æœ±æ¸…å","æ»•é‡‘æƒ","èµµåšå‡¯","å²æ•¬è±ª","èµµå›½ç¿”","å‘¨è‡´é”¦"],
                drawnMember: null
            },
            {
                id: 5,
                name: "5",
                members: ["è¤šå®æˆ", "éƒ­ç»§å¯Œ","å¼ æ–‡éš†","é›·æ˜Ÿæ˜Ÿ","å¼ å¤","èˆ’é•¿æ±Ÿ","åˆ˜åŸ¹è¡Œ","ææ˜¾æ—","ç‹ä¾æ¥ ","è–›æ¶µäºˆ","é™ˆä½³ä¹","é™ˆä½³","ç®¡å›½åº†","å†¯ä»»æ°"],
                drawnMember: null
            },
            {
                id: 6,
                name: "6",
                members: [ "å”å»ºè¾‰","å§œæ¶µ","å¶å›½å®‡","è‘£ç¿¼é“­","æ¢…èˆªè ","å¼ ç£Š","é™¶åšå","è¢çƒˆé˜³","ç¥é›¨å†œ"],
                drawnMember: null
            },
            {
                id: 7,
                name: "7",
                members: ["é«˜ä½©æˆ", "ç¿Ÿå®¶ä¹","é‚“åº†å®","å¶ä¿Š","é»„ä¿Šå–†","å¼ ä¹ä¹","ä¼Šæ¢“èˆª","è®¸æ½˜","è°¢ä¹™"],
                drawnMember: null
            },
            {
                id: 8,
                name: "8",
                members: ["æè‰³é­", "æ¨æ¾³é£","é—«æ ‘æ°","å†¯æ¸","ç½—æ°","å‘¨æ³½é›·","ç‹æ–Œ","å¸¸æ ‹","å¼ ç‰¹","å­™å¯èˆª","å­™æµ©æ˜","éƒ­æ¶¦","å²ç¼˜æ»¡","é™ˆç‚«"],
                drawnMember: null
            },
            {
                id: 9,
                name: "9",
                members: ["è°¢æ——è¾‰", "å²åˆ›æˆ","åˆ˜å°æµ·","ä»˜å¼º","é›’ç»…ç¦","å¼ å›½æ¢","å¤æ™ºå¿ƒ","æå˜‰å®‡","è’²å½¦ç™¾","ç”°å®¶æ¢"],
                drawnMember: null
            },
            {
                id: 10,
                name: "10",
                members: ["ç‹å®‡èˆª", "é™ˆç‰å°","ç‹å˜‰è±ª","é‚“ç£Š","é»„æ°","é™ˆå˜‰æ°","æ¸©å˜‰å‡¯","ç”³å­”æ–‡","é™ˆå¿—å¼º","ç‹å¸…"],
                drawnMember: null
            },
            {
                id: 11,
                name: "11",
                members: ["æ¼†å›½è‡£", "éƒ­æ˜¾æ´‹","å½­æ©è€€","é æ¶µç¡•","æˆ´æ°","é‚¢åšå¸…","æ±¤ä¼Ÿæ°"],
                drawnMember: null
            },
            {
                id: 12,
                name: "12",
                members: ["å´ç¤¼ç¥¥", "åˆ˜å®‡ç¿±","çºªæ˜æ™º","æ±¤è‡£","å†¯ä½³è±ª","èµµçºªé¾™","é™ˆåŠ›ç•…","ç‹æŸå·","ç‹å…†æ³½","æ¨Šç£Š"],
                drawnMember: null
            }
        ];
        
        // è·Ÿè¸ªæ¯ä¸ªæˆå‘˜æ˜¯å¦å·²è¢«æŠ½å–
        const allMembers = {};
        groups.forEach(group => {
            group.members.forEach(member => {
                allMembers[member] = false; // falseè¡¨ç¤ºæœªä¸­å¥–
            });
        });
        
        // å½“å‰é€‰ä¸­çš„ç»„
        let selectedGroup = 1;
        // æŠ½äººå†å²è®°å½•
        const drawHistory = [];
        
        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            // ç”Ÿæˆåˆ†é˜Ÿé€‰æ‹©æŒ‰é’®
            const groupButtonsContainer = document.getElementById('groupButtons');
            groups.forEach(group => {
                const button = document.createElement('button');
                button.className = 'group-btn';
                if (group.id === selectedGroup) button.classList.add('active');
                button.textContent = group.id;
                button.dataset.groupId = group.id;
                button.title = group.name;
                button.addEventListener('click', () => selectGroup(group.id));
                groupButtonsContainer.appendChild(button);
            });
            
            // ç”Ÿæˆç»“æœå±•ç¤ºå¡ç‰‡
            const resultContainer = document.getElementById('resultContainer');
            groups.forEach(group => {
                const card = document.createElement('div');
                card.className = 'result-card';
                card.id = `resultCard-${group.id}`;
                
                card.innerHTML = `
                    <h3>${group.name}</h3>
                    <div class="result-name" id="resultName-${group.id}">ç­‰å¾…æŠ½å¥–</div>
                    <div class="result-status" id="resultStatus-${group.id}">æˆå‘˜: ${group.members.join("ã€")}</div>
                `;
                
                resultContainer.appendChild(card);
            });
            
            // åˆå§‹æ˜¾ç¤ºç¬¬ä¸€ç»„æˆå‘˜
            updateMembersDisplay();
            
            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            document.getElementById('drawBtn').addEventListener('click', drawLottery);
            document.getElementById('resetBtn').addEventListener('click', resetGroup);
            document.getElementById('drawAllBtn').addEventListener('click', drawAllGroups);
            document.getElementById('resetAllBtn').addEventListener('click', resetAllGroups);
            
            // æ·»åŠ é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    drawLottery();
                }
                
                // æ•°å­—é”®1-9é€‰æ‹©å°ç»„
                if (e.key >= '1' && e.key <= '9') {
                    selectGroup(parseInt(e.key));
                }
                
                // 0, -, = å¯¹åº”10, 11, 12ç»„
                if (e.key === '0') selectGroup(10);
                if (e.key === '-') selectGroup(11);
                if (e.key === '=') selectGroup(12);
            });
        });
        
        // é€‰æ‹©ç»„
        function selectGroup(groupId) {
            selectedGroup = groupId;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.group-btn').forEach(btn => {
                if (parseInt(btn.dataset.groupId) === groupId) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // æ›´æ–°æˆå‘˜æ˜¾ç¤º
            updateMembersDisplay();
            
            // é«˜äº®æ˜¾ç¤ºå¯¹åº”ç»“æœå¡ç‰‡
            document.querySelectorAll('.result-card').forEach(card => {
                card.classList.remove('drawing-animation');
            });
            
            const selectedCard = document.getElementById(`resultCard-${groupId}`);
            selectedCard.classList.add('drawing-animation');
            
            // ç§»é™¤å…¶ä»–å¡ç‰‡çš„é«˜äº®
            setTimeout(() => {
                selectedCard.classList.remove('drawing-animation');
            }, 1000);
        }
        
        // æ›´æ–°æˆå‘˜æ˜¾ç¤º
        function updateMembersDisplay() {
            const group = groups.find(g => g.id === selectedGroup);
            const membersTitle = document.getElementById('membersTitle');
            const membersContainer = document.getElementById('membersContainer');
            
            membersTitle.textContent = `${group.name}æˆå‘˜ (${group.members.length}äºº)ï¼š`;
            
            // æ¸…ç©ºå®¹å™¨
            membersContainer.innerHTML = '';
            
            // æ·»åŠ æˆå‘˜æ ‡ç­¾
            group.members.forEach(member => {
                const memberTag = document.createElement('div');
                memberTag.className = 'member-tag';
                memberTag.textContent = member;
                
                // å¦‚æœè¯¥æˆå‘˜å·²ä¸­å¥–ï¼Œæ·»åŠ ç‰¹æ®Šæ ·å¼
                if (allMembers[member]) {
                    memberTag.style.background = 'rgba(255, 215, 0, 0.3)';
                    memberTag.style.color = '#ffd700';
                    memberTag.style.fontWeight = 'bold';
                }
                
                membersContainer.appendChild(memberTag);
            });
        }
        
        // æŠ½å–å•ä¸ªç»„
        function drawLottery() {
            const group = groups.find(g => g.id === selectedGroup);
            
            // å¦‚æœè¯¥ç»„å·²æŠ½å–ï¼Œå…ˆè¯¢é—®æ˜¯å¦é‡ç½®
            if (group.drawnMember) {
                if (!confirm(`${group.name}å·²ç»æŠ½å–äº† ${group.drawnMember}ï¼Œæ˜¯å¦é‡æ–°æŠ½å–ï¼Ÿ`)) {
                    return;
                }
            }
            
            // è·å–æœªä¸­å¥–çš„æˆå‘˜
            const availableMembers = group.members.filter(member => !allMembers[member]);
            
            if (availableMembers.length === 0) {
                alert(`${group.name}æ‰€æœ‰æˆå‘˜éƒ½å·²ä¸­å¥–ï¼Œæ— æ³•ç»§ç»­æŠ½å–ï¼`);
                return;
            }
            
            // å¼€å§‹æŠ½å¥–åŠ¨ç”»
            const resultCard = document.getElementById(`resultCard-${selectedGroup}`);
            const resultName = document.getElementById(`resultName-${selectedGroup}`);
            const resultStatus = document.getElementById(`resultStatus-${selectedGroup}`);
            
            resultCard.classList.add('drawing-animation');
            
            // æ¨¡æ‹ŸæŠ½å¥–è¿‡ç¨‹
            let drawCount = 0;
            const maxDrawCount = 25;
            let drawSpeed = 100; // åˆå§‹é€Ÿåº¦ï¼ˆæ¯«ç§’ï¼‰
            
            const drawInterval = setInterval(() => {
                // éšæœºæ˜¾ç¤ºä¸€ä¸ªåå­—
                const randomIndex = Math.floor(Math.random() * availableMembers.length);
                resultName.textContent = availableMembers[randomIndex];
                
                drawCount++;
                
                // é€æ¸å‡æ…¢é€Ÿåº¦
                if (drawCount > 15) {
                    drawSpeed = 150;
                }
                if (drawCount > 20) {
                    drawSpeed = 200;
                }
                
                if (drawCount >= maxDrawCount) {
                    clearInterval(drawInterval);
                    
                    // ç¡®å®šæœ€ç»ˆæŠ½ä¸­è€…
                    const winnerIndex = Math.floor(Math.random() * availableMembers.length);
                    const winner = availableMembers[winnerIndex];
                    
                    // æ›´æ–°æ•°æ®
                    allMembers[winner] = true;
                    group.drawnMember = winner;
                    
                    // æ›´æ–°UI
                    resultName.textContent = winner;
                    resultStatus.innerHTML = `<span style="color:#4CAF50; font-weight:bold;">ğŸ‰ æŠ½ä¸­è€… | æˆå‘˜: ${group.members.join("ã€")}</span>`;
                    resultCard.classList.add('drawn');
                    resultCard.classList.remove('drawing-animation');
                    resultCard.classList.add('winner-effect');
                    
                    // æ›´æ–°æˆå‘˜æ˜¾ç¤º
                    updateMembersDisplay();
                    
                    // æ·»åŠ åˆ°å†å²è®°å½•
                    const now = new Date();
                    const timeStr = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
                    
                    const historyItem = {
                        time: timeStr,
                        group: group.name,
                        winner: winner
                    };
                    drawHistory.unshift(historyItem);
                    updateHistory();
                    
                    // ç§»é™¤åŠ¨ç”»ç±»
                    setTimeout(() => {
                        resultCard.classList.remove('winner-effect');
                    }, 1500);
                    
                    // æ’­æ”¾æŠ½ä¸­éŸ³æ•ˆ
                    playWinnerSound();
                }
            }, drawSpeed);
        }
        
        // é‡ç½®å½“å‰å°ç»„
        function resetGroup() {
            const group = groups.find(g => g.id === selectedGroup);
            
            if (!group.drawnMember) {
                alert(`${group.name}å°šæœªæŠ½å–ï¼Œæ— éœ€é‡ç½®ï¼`);
                return;
            }
            
            if (!confirm(`ç¡®å®šè¦é‡ç½®${group.name}çš„æŠ½å¥–ç»“æœå—ï¼Ÿ`)) {
                return;
            }
            
            // é‡ç½®è¯¥ç»„æˆå‘˜çš„ä¸­å¥–çŠ¶æ€
            if (group.drawnMember) {
                allMembers[group.drawnMember] = false;
                group.drawnMember = null;
            }
            
            // æ›´æ–°UI
            const resultName = document.getElementById(`resultName-${selectedGroup}`);
            const resultStatus = document.getElementById(`resultStatus-${selectedGroup}`);
            const resultCard = document.getElementById(`resultCard-${selectedGroup}`);
            
            resultName.textContent = 'ç­‰å¾…ä¸­';
            resultStatus.textContent = `æˆå‘˜: ${group.members.join("ã€")}`;
            resultCard.classList.remove('drawn');
            
            // ä»å†å²è®°å½•ä¸­ç§»é™¤
            const winnerName = resultName.textContent;
            const index = drawHistory.findIndex(item => 
                item.group === group.name && 
                item.winner === winnerName
            );
            
            if (index !== -1) {
                drawHistory.splice(index, 1);
                updateHistory();
            }
            
            // æ›´æ–°æˆå‘˜æ˜¾ç¤º
            updateMembersDisplay();
            
            alert(`${group.name}å·²é‡ç½®ï¼Œå¯ä»¥é‡æ–°æŠ½äººï¼`);
        }
        
        // ä¸€é”®æŠ½å–æ‰€æœ‰ç»„
        function drawAllGroups() {
            const groupsToDraw = groups.filter(group => !group.drawnMember);
            
            if (groupsToDraw.length === 0) {
                alert('æ‰€æœ‰åˆ†é˜Ÿç»„éƒ½å·²æŠ½å–å®Œæ¯•ï¼');
                return;
            }
            
            if (!confirm(`ç¡®å®šè¦ä¸€é”®æŠ½å–æ‰€æœ‰${groupsToDraw.length}ä¸ªæœªæŠ½å–ç»„å—ï¼Ÿ`)) {
                return;
            }
            
            // ä¸ºæ¯ä¸ªæœªæŠ½å–çš„ç»„æŠ½å–äººå‘˜
            groupsToDraw.forEach(group => {
                const availableMembers = group.members.filter(member => !allMembers[member]);
                
                if (availableMembers.length > 0) {
                    const winnerIndex = Math.floor(Math.random() * availableMembers.length);
                    const winner = availableMembers[winnerIndex];
                    
                    // æ›´æ–°æ•°æ®
                    allMembers[winner] = true;
                    group.drawnMember = winner;
                    
                    // æ›´æ–°UI
                    const resultName = document.getElementById(`resultName-${group.id}`);
                    const resultStatus = document.getElementById(`resultStatus-${group.id}`);
                    const resultCard = document.getElementById(`resultCard-${group.id}`);
                    
                    resultName.textContent = winner;
                    resultStatus.innerHTML = `<span style="color:#4CAF50; font-weight:bold;">ğŸ‰ æŠ½ä¸­è€… | æˆå‘˜: ${group.members.join("ã€")}</span>`;
                    resultCard.classList.add('drawn');
                    
                    // æ·»åŠ åˆ°å†å²è®°å½•
                    const now = new Date();
                    const timeStr = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
                    
                    const historyItem = {
                        time: timeStr,
                        group: group.name,
                        winner: winner
                    };
                    drawHistory.unshift(historyItem);
                }
            });
            
            updateHistory();
            updateMembersDisplay();
            playWinnerSound();
            alert(`å·²ä¸º${groupsToDraw.length}ä¸ªç»„æŠ½å–äº†äººå‘˜ï¼`);
        }
        
        // é‡ç½®æ‰€æœ‰å°ç»„
        function resetAllGroups() {
            if (groups.every(group => !group.drawnMember)) {
                alert('æ‰€æœ‰ç»„éƒ½å°šæœªæŠ½å–ï¼Œæ— éœ€é‡ç½®ï¼');
                return;
            }
            
            if (!confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰ç»„çš„æŠ½å¥–ç»“æœå—ï¼Ÿè¿™å°†æ¸…é™¤æ‰€æœ‰æŠ½å–è®°å½•ã€‚')) {
                return;
            }
            
            // é‡ç½®æ‰€æœ‰æ•°æ®
            groups.forEach(group => {
                if (group.drawnMember) {
                    allMembers[group.drawnMember] = false;
                    group.drawnMember = null;
                    
                    // æ›´æ–°UI
                    const resultName = document.getElementById(`resultName-${group.id}`);
                    const resultStatus = document.getElementById(`resultStatus-${group.id}`);
                    const resultCard = document.getElementById(`resultCard-${group.id}`);
                    
                    resultName.textContent = 'ç­‰å¾…æŠ½å–';
                    resultStatus.textContent = `æˆå‘˜: ${group.members.join("ã€")}`;
                    resultCard.classList.remove('drawn');
                }
            });
            
            // æ¸…ç©ºå†å²è®°å½•
            drawHistory.length = 0;
            updateHistory();
            
            // æ›´æ–°æˆå‘˜æ˜¾ç¤º
            updateMembersDisplay();
            
            alert('æ‰€æœ‰ç»„å·²é‡ç½®ï¼Œå¯ä»¥é‡æ–°å¼€å§‹æŠ½äººï¼');
        }
        
        // æ›´æ–°å†å²è®°å½•
        function updateHistory() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            
            // æ˜¾ç¤ºæœ€è¿‘15æ¡è®°å½•
            const recentHistory = drawHistory.slice(0, 15);
            
            if (recentHistory.length === 0) {
                historyList.innerHTML = '<div class="history-item" style="justify-content:center;">æš‚æ— æŠ½å–è®°å½•</div>';
                return;
            }
            
            recentHistory.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <span>${item.time}</span>
                    <span>${item.group}</span>
                    <span class="history-winner">${item.winner}</span>
                `;
                historyList.appendChild(historyItem);
            });
        }
        
        // æ’­æ”¾æŠ½ä¸­éŸ³æ•ˆ
        function playWinnerSound() {
            try {
                // åˆ›å»ºç®€å•çš„éŸ³æ•ˆ
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // åˆ›å»ºå¤šä¸ªæŒ¯è¡å™¨æ¨¡æ‹Ÿåº†ç¥éŸ³æ•ˆ
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        // è®¾ç½®éŸ³é«˜
                        const frequencies = [523.25, 659.25, 783.99, 1046.50];
                        oscillator.frequency.setValueAtTime(frequencies[i % frequencies.length], audioContext.currentTime);
                        
                        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                        
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.5);
                    }, i * 100);
                }
            } catch (e) {
                console.log("éŸ³é¢‘æ’­æ”¾å¤±è´¥ï¼Œä¸å½±å“æŠ½å¥–åŠŸèƒ½");
            }
        }
        
        // åˆå§‹æ›´æ–°å†å²è®°å½•
        updateHistory();
    </script>
</body>
</html>
